#!/usr/bin/env bash

# Define text styles
bold=$(tput bold)
normal=$(tput sgr0)
italic=$(tput sitm)

# Define text foreground colors
# fg_color0=$(tput setaf 0) # Don't need black foreground color
fg_color1=$(tput setaf 1)
fg_color2=$(tput setaf 2)
fg_color3=$(tput setaf 3)
fg_color4=$(tput setaf 4)
fg_color5=$(tput setaf 5)
fg_color6=$(tput setaf 6)
fg_color7=$(tput setaf 7)

function virtualenv_info(){
        local _venv
        
        if [[ -n "$VIRTUAL_ENV" ]]; then {
                _venv="${VIRTUAL_ENV##*/}"
        } else {
                _venv=''
        } fi
        
        if [[ -n "$_venv" ]] ; then {
                echo " (venv:$_venv)"
        } fi
}

function git_info(){
        local _git
        
        if [[ -f "/usr/share/git/git-prompt.sh" ]]; then {
                # Load Git functions
                source "/usr/share/git/git-prompt.sh"
                _git="$(__git_ps1 "%s")"
        } else {
                _git=''
        } fi
        
        if [[ -n "$_git" ]] ; then {
                echo " (git:$_git)"
        } fi
}

function exit_status(){
        if [[ ! $1 == 0 ]] ; then {
                local _char
                _char="â¨‰"

                if [[ -n "$_char" ]] ; then {
                        echo "$_char "  
                } fi
        } fi
}


function set_prompts(){
        exit_code=$? # Collect previous exit code for exit_status()

        # NOTE: "\[" and "\]" are used so that bash can calculate the number
        # of printed characters so that the prompt doesn't do strange things
        # when editing the entered text. All nonprinted characters should be
        # escaped in this manner to avoid misbehavior.
        
        PS0='' # Not used - displayed after each command, before any output
        PS1="\[${fg_color1}${bold}\]$(exit_status $exit_code)\[${fg_color2}\]\u\[${normal}\]@\[${bold}${fg_color3}\]\h\[${normal}\] \[${fg_color4}\]\w\[${fg_color5}\]$(git_info)\[${fg_color6}\]$(virtualenv_info) \[${fg_color7}${italic}\]\$\[${normal}\] " # Primary output displayed before command
        PS2="\[${fg_color1}${bold}\]$(exit_status exit_code)\[${fg_color2}\]\u\[${normal}\] " # Secondary prompt when a command needs more input
        PS3='' # Not used - bash select interactive menus
        PS4='' # Not used - bash debug
}

PROMPT_COMMAND=set_prompts
